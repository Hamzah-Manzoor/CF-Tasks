<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Leaves</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'employee_management/css/projects.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <!-- Header Section -->
    <header>
        <div class="header-container">
            <div class="logo-container">
                <a href="/employee_management">
                    <img src="{% static 'employee_management/assets/codefulcrum_logo.jpeg' %}" alt="Company Logo" class="company-logo">
                    <span class="company-name">Code Fulcrum</span>
                </a>
            </div>
            <nav class="main-menu">
                <ul>
                    <li><a href="/employee_management">Home</a></li>
                    <li><a href="/employee_management/events">Events</a></li>
                    <li><a href="/employee_management/leaves">Leaves</a></li>
                    <li><a href="/employee_management/profile">Profile</a></li>
                </ul>
            </nav>
            <div class="profile-icon-container">
                <i class="fas fa-user-circle profile-icon" id="profile-icon"></i>
                <nav class="profile-menu" id="profile-menu">
                    <ul>
                        <li><a href="/employee_management/profile">Update Profile</a></li>
                        <li><a href="/employee_management/logout">Logout</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <!-- Divider -->
    <hr class="divider">

    <main class="main-section">

        <div class="feedback-container">
            <h1>Manage Feedback</h1>
            {% if perms.feedback.create %}
                <button class="btn" id="add-feedback-btn">Add Feedback</button>
            {% endif %}
            <div class="feedback-list" id="feedback-list">
                <!-- Feedback items will be appended here -->
                {% for feedback in feedbacks %}
                <div class="feedback-item">
                    <p><strong>Employee ID:</strong> {{ feedback.employee_id }}</p>
                    <p><strong>Feedback:</strong> {{ feedback.feedback }}</p>
                    {% if perms.feedback.update %}
                        <button class="btn edit-btn" data-id="{{ feedback.id }}" onclick="openEditModal('{{ feedback.id }}', '{{ feedback.employee_id }}', '{{ feedback.feedback }}')">Edit</button>
                    {% endif %}
                    {% if perms.feedback.delete %}
                    <form action="{% url 'delete_feedback' feedback.id %}" method="post" style="display:inline;">
                        {% csrf_token %}
                        <button type="submit" class="btn delete-btn">Delete</button>
                    </form>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="modal" id="feedback-modal">
            <div class="modal-content">
                <span class="close-btn" id="close-modal-btn">&times;</span>
                <h2 id="modal-title">Add Feedback</h2>
                <form id="feedback-form" action="{% url 'add_feedback' %}" method="post">
                    {% csrf_token %}
                    <input type="hidden" id="feedback-id" name="feedback_id">
                    <label for="employee-id">Employee ID</label>
                    <input type="text" id="employee-id" name="employee_id" required>
                    <label for="feedback-text">Feedback</label>
                    <textarea id="feedback-text" name="feedback" required></textarea>
                    <button type="submit" class="btn">Submit</button>
                </form>
            </div>
        </div>

        <!-- Edit Feedback Modal -->
        <div class="modal" id="edit-feedback-modal">
            <div class="modal-content">
                <span class="close-btn" id="close-edit-modal-btn">&times;</span>
                <h2 id="edit-modal-title">Edit Feedback</h2>
                <form id="edit-feedback-form" action="{% url 'edit_feedback' feedback_id=0 %}" method="post" style="display:inline;">
                    {% csrf_token %}
                    <input type="hidden" id="edit-feedback-id" name="feedback_id">
                    <label for="edit-employee-id">Employee ID</label>
                    <input type="text" id="edit-employee-id" name="employee_id" required>
                    <label for="edit-feedback-text">Feedback</label>
                    <textarea id="edit-feedback-text" name="feedback" required></textarea>
                    <button type="submit" class="btn">Submit</button>
                </form>
            </div>
        </div>

    </main>


    <footer>
        <div class="footer-container">
            <div class="footer-left">
                <p>&copy; 2024 Code Fulcrum. All rights reserved.</p>
            </div>
            <div class="footer-right">
                <a href="privacy.html">Privacy Policy</a>
                <a href="terms.html">Terms of Service</a>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const feedbackModal = document.getElementById('feedback-modal');
            const addFeedbackBtn = document.getElementById('add-feedback-btn');
            const closeModalBtn = document.getElementById('close-modal-btn');

            const editFeedbackModal = document.getElementById('edit-feedback-modal');
            const closeEditModalBtn = document.getElementById('close-edit-modal-btn');

            addFeedbackBtn.addEventListener('click', () => {
                document.getElementById('modal-title').textContent = 'Add Feedback';
                document.getElementById('feedback-form').reset();
                feedbackModal.style.display = 'block';
            });

            closeModalBtn.addEventListener('click', () => {
                feedbackModal.style.display = 'none';
            });

            closeEditModalBtn.addEventListener('click', () => {
                editFeedbackModal.style.display = 'none';
            });

            window.onclick = (event) => {
                if (event.target == feedbackModal) {
                    feedbackModal.style.display = 'none';
                }
                if (event.target == editFeedbackModal) {
                    editFeedbackModal.style.display = 'none';
                }
            };
        });

        function openEditModal(id, employee_id, feedback) {
            document.getElementById('edit-modal-title').textContent = 'Edit Feedback';
            document.getElementById('edit-feedback-id').value = id;
            document.getElementById('edit-employee-id').value = employee_id;
            document.getElementById('edit-feedback-text').value = feedback;
            const editFeedbackForm = document.getElementById('edit-feedback-form');
            editFeedbackForm.action = `{% url 'edit_feedback' feedback_id=0 %}`.replace('0', id);
            document.getElementById('edit-feedback-modal').style.display = 'block';
        }
    </script>


</body>
</html>
